<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŸ¥è¯†é—®ç­”åŠ©æ‰‹</title>
    <script src="https://unpkg.com/jszip/dist/jszip.min.js"></script>
    <script src="https://unpkg.com/docx-preview/dist/docx-preview.min.js"></script>
    <style>
        :root {
            --primary-color: #4A89E8;
            --primary-color-light: #e9f2ff;
            --background-color: #f5f7fa;
            --widget-bg-color: #ffffff;
            --text-color-primary: #1a1a1a;
            --text-color-secondary: #5f6368;
            --border-color: #e0e4e8;
            --bot-message-bg: #f8f9fb;
            --user-message-bg: var(--primary-color-light);
            --shadow-color: rgba(0, 0, 0, 0.08);
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            display: block;
            min-height: 100vh;
        }
        .chat-widget {
            width: 100%;
            height: 100vh;
            max-height: none;
            border-radius: 0;
            box-shadow: none;
            background-color: var(--widget-bg-color);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        .chat-header {
            padding: 16px 24px;
            background-color: var(--widget-bg-color);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }
        .header-title-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .header-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #6B73FF, #4F5BFF);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 700;
            color: white;
            font-size: 20px;
        }
        .header-title h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            color: var(--text-color-primary);
        }
        .header-actions svg {
            width: 22px;
            height: 22px;
            cursor: pointer;
            color: var(--text-color-secondary);
            transition: color 0.2s, transform 0.2s;
        }
        .chat-body {
            flex-grow: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            padding: 10px;
            gap: 0;
        }
        .message {
            display: flex;
            margin-bottom: 16px;
            max-width: 80%;
            animation: fadeInUp 0.5s ease;
        }
        .message-container {
            display: flex;
            flex-direction: column;
        }
        .message-content {
            padding: 14px 18px;
            border-radius: 16px;
            font-size: 15px;
            line-height: 1.6;
            word-wrap: break-word;
            box-shadow: 0 2px 8px var(--shadow-color);
        }
        .bot-message .message-content {
            background-color: var(--bot-message-bg);
            border-top-left-radius: 4px;
            border: 1px solid var(--border-color);
        }
        .user-message .message-content {
            background-color: var(--user-message-bg);
            color: #1a2a44;
            border-top-right-radius: 4px;
        }
        .bot-message {
            align-self: flex-start;
            gap: 12px;
        }
        .bot-message .avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #6B73FF, #4F5BFF);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 700;
            color: white;
            font-size: 20px;
            flex-shrink: 0;
        }
        .user-message {
            align-self: flex-end;
        }
        /* --- çŒœä½ æƒ³é—® & åç»­é—®é¢˜é€šç”¨æ ·å¼ --- */
        .question-list-container {
            padding: 8px;
            animation: fadeIn 0.5s ease;
            background-color: #ffffff;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            box-shadow: 0 2px 6px var(--shadow-color);
            margin: 0 16px;
        }
        .question-list-title {
            color: var(--text-color-secondary);
            font-size: 13px;
            margin-bottom: 8px;
            text-align: center;
            font-weight: 500;
            padding-bottom: 6px;
            border-bottom: 1px solid var(--border-color);
        }
        .question-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            margin-bottom: 4px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
            font-size: 14px;
            color: var(--text-color-primary);
            background-color: #f9fafc;
            border: 1px solid transparent;
        }
        .question-item:last-child {
            margin-bottom: 0;
        }
        .question-item:hover {
            background-color: #f1f3f5;
            transform: translateY(-1px);
            border-color: var(--border-color);
        }
        .question-item-icon {
            width: 6px;
            height: 6px;
            background-color: #ffe5e7;
            border: 1px solid #e57373;
            border-radius: 50%;
            margin-right: 10px;
            flex-shrink: 0;
        }
        .chat-input-area {
            border-top: 1px solid var(--border-color);
            padding: 10px 24px;
            background-color: var(--widget-bg-color);
            flex-shrink: 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.03);
        }
        .input-wrapper {
            width: 90%;
            max-width: 400px;
            margin: 0 auto;
            height: 48px;
            display: flex;
            align-items: center;
            background-color: #f5f6f8;
            border-radius: 24px;
            padding: 0 16px;
            gap: 12px;
            border: 2px solid transparent;
            transition: all 0.2s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .input-wrapper:focus-within {
            border-color: var(--primary-color);
            background-color: #fff;
            box-shadow: 0 0 0 3px rgba(74, 137, 232, 0.2);
        }
        .input-actions .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s;
        }
        .chat-input {
            flex-grow: 1;
            border: none;
            background: transparent;
            padding: 0;
            font-size: 15px;
            color: var(--text-color-primary);
            resize: none;
            height: auto;
            max-height: 120px;
            line-height: 48px;
        }
        .chat-input:focus {
            outline: none;
        }
        .send-button {
            background-color: var(--primary-color);
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
            transition: transform 0.2s, background-color 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 10px rgba(74, 137, 232, 0.3);
        }
        .send-button:hover {
            transform: scale(1.05);
            background-color: #3a79d8;
            box-shadow: 0 6px 14px rgba(74, 137, 232, 0.4);
        }
        .send-button svg {
            color: white;
            width: 22px;
            height: 22px;
        }
        .disclaimer {
            font-size: 11px;
            color: #b0b4b8;
            text-align: center;
            margin-top: 10px;
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(12px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* å¼¹çª—æ ·å¼ */
        .source-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            display: flex;
            flex-direction: row;
            width: 95%;
            max-width: 1400px;
            height: auto;
            min-height: 90vh;
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            background: white;
            color: #5f6368;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            font-size: 18px;
            line-height: 30px;
            text-align: center;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            z-index: 1001;
        }
        .image-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 15px;
            border-right: 1px solid #ddd;
            overflow-y: auto;
        }
        .image-container:last-child {
            border-right: none;
        }
        .image-title {
            color: #1a1a1a;
            margin: 0 0 10px;
            font-size: 16px;
            text-align: center;
        }
        
        /* docx-preview æ ·å¼ï¼Œç¡®ä¿å†…å®¹é“ºæ»¡ */
        .docx-preview {
            width: 100% !important; /* å¼ºåˆ¶å®½åº¦ä¸º100% */
            max-width: 100%;
            height: auto;
            box-sizing: border-box; /* åŒ…å«paddingå’Œborderåœ¨å†…çš„æ€»å®½åº¦ */
        }
    </style>
</head>
<body>
    <div class="chat-widget">
        <header class="chat-header">
            <div class="header-title-container">
                <div class="header-icon">æ™º</div>
                <div class="header-title"><h3>æ™ºèƒ½åŠ©æ‰‹</h3></div>
            </div>
            <div class="header-actions">
                <svg title="å…³é—­" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41z"></path></svg>
            </div>
        </header>
        <div class="chat-body" id="chat-body">
            <div class="message bot-message" id="initial-welcome">
                <div class="avatar">æ™º</div>
                <div class="message-container">
                    <div class="message-content">æ‚¨å¥½ï¼Œæˆ‘æ˜¯æ‚¨çš„åˆ¶åº¦è§£ç­”åŠ©æ‰‹ï¼Œè¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨ï¼Ÿ</div>
                </div>
            </div>
            <div class="question-list-container">
                <div class="question-list-title">â€”â€”â€”â€” çŒœä½ æƒ³é—® â€”â€”â€”â€”</div>
                <div class="question-list">
                    <div class="question-item" onclick="selectQuestion('æ€»ç»“å®‰ä¸œå’Œæ–¯ä¼¦è´è°¢QHSEåŸåˆ™çš„å·®å¼‚')">
                        <div class="question-item-icon"></div>
                        <div>æ€»ç»“å®‰ä¸œå’Œæ–¯ä¼¦è´è°¢QHSEåŸåˆ™çš„å·®å¼‚</div>
                    </div>
                </div>
            </div>
        </div>
        <footer class="chat-input-area">
            <div class="input-wrapper">
                <textarea id="chat-input" class="chat-input" placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜..." rows="1"></textarea>
                <button class="send-button" id="send-button" title="å‘é€">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M2.01 21L23 12L2.01 3L2 10l15 2l-15 2z"></path></svg>
                </button>
            </div>
            <p class="disclaimer">éƒ¨åˆ†å†…å®¹ç”±AIå¤§æ¨¡å‹æ™ºèƒ½ç”Ÿæˆï¼Œä¸ä»£è¡¨å‚å•†çš„è§‚ç‚¹</p>
        </footer>
    </div>

    <div id="source-modal" class="source-modal">
        <div class="modal-content">
            <button id="close-modal" class="close-modal">&times;</button>
            <div class="image-container">
                <h3 class="image-title">å®‰ä¸œ-å®‰ä¸œçŸ³æ²¹QHSEï¼ˆå®‰å…¨ç”Ÿäº§ï¼‰ç®¡ç†è§„å®š(ZD-ZH-016V0-2021</h3>
                <div id="anton-docx-container" style="width: 100%; height: 80vh; overflow-y: auto;"></div>
            </div>
            <div class="image-container">
                <h3 class="image-title">æ–¯ä¼¦è´è°¢-HSE_to_Go_Handbook</h3>
                <div id="schlumberger-docx-container" style="width: 100%; height: 80vh; overflow-y: auto;"></div>
            </div>
        </div>
    </div>

    <script>
        const chatBody = document.getElementById('chat-body');
        const chatInput = document.getElementById('chat-input');
        const sendButton = document.getElementById('send-button');
        const modal = document.getElementById('source-modal');
        const closeModalBtn = document.getElementById('close-modal');

        // å…³é—­å¼¹çª—
        closeModalBtn.addEventListener('click', () => {
            modal.style.display = 'none';
        });
        modal.addEventListener('click', (e) => {
            if (e.target === modal) modal.style.display = 'none';
        });

        // è¾…åŠ©å‡½æ•°ï¼šè·å– docx æ¯é¡µèŠ‚ç‚¹ï¼ˆå…¼å®¹å¤šç§ç»“æ„ï¼‰
        function getDocxPages(container) {
            const selectors = [
                '.docx .page',
                '.docx-page',
                '.docx-wrapper .page',
                '.docx .docx-page',
                '.docx-preview .page',
                '.docx .document .page'
            ];
            for (const sel of selectors) {
                const nodes = container.querySelectorAll(sel);
                if (nodes && nodes.length > 1) return Array.from(nodes);
                if (nodes && nodes.length === 1) {
                    const sub = nodes[0].querySelectorAll('.page, .docx-page, section');
                    if (sub && sub.length > 0) return Array.from(sub);
                }
            }
            // å°è¯•ä» wrapper å†…éƒ¨æŸ¥æ‰¾
            const wrapper = container.querySelector('.docx, .docx-preview, .docx-wrapper');
            if (wrapper) {
                const directChildren = Array.from(wrapper.children || []);
                if (directChildren.length > 1) return directChildren;
                const subPages = wrapper.querySelectorAll('.page, .docx-page, section');
                if (subPages && subPages.length > 0) return Array.from(subPages);
            }
            return [];
        }

        // è¾…åŠ©å‡½æ•°ï¼šæ»šåŠ¨åˆ°ç¬¬ N é¡µï¼ˆä» 1 å¼€å§‹ï¼‰ï¼Œå¸¦é‡è¯•ä»¥åº”å¯¹å›¾ç‰‡åŠ è½½å¯¼è‡´çš„é‡æ’
        function scrollToPageByIndex(containerId, pageIndex) {
            const container = document.getElementById(containerId);
            if (!container || pageIndex < 1) return;
            const doScroll = () => {
                const pages = getDocxPages(container);
                if (!pages || pages.length === 0) return false;
                const targetIndex = Math.min(pageIndex - 1, pages.length - 1);
                const target = pages[targetIndex];
                const top = target.getBoundingClientRect().top - container.getBoundingClientRect().top + container.scrollTop;
                container.scrollTo({ top, behavior: 'smooth' });
                return true;
            };
            if (!doScroll()) return;
            // é‡è¯•ä¸¤æ¬¡ï¼Œå¤„ç†å¼‚æ­¥èµ„æºåŠ è½½åçš„å¸ƒå±€å˜åŒ–
            setTimeout(doScroll, 200);
            setTimeout(doScroll, 800);
        }

        // è§‚å¯Ÿå®¹å™¨å˜åŒ–ï¼ŒæŒç»­å°è¯•æ»šåŠ¨ï¼Œç›´è‡³æˆåŠŸç¨³å®šæˆ–è¶…æ—¶
        function ensureScrollToPage(containerId, pageIndex, timeoutMs = 5000) {
            const container = document.getElementById(containerId);
            if (!container) return;
            let disconnected = false;
            const observer = new MutationObserver(() => {
                scrollToPageByIndex(containerId, pageIndex);
            });
            try {
                observer.observe(container, { childList: true, subtree: true });
            } catch (_) {}
            // åˆæ¬¡ä¸å»¶è¿Ÿé‡è¯•
            scrollToPageByIndex(containerId, pageIndex);
            const t1 = setTimeout(() => scrollToPageByIndex(containerId, pageIndex), 300);
            const t2 = setTimeout(() => scrollToPageByIndex(containerId, pageIndex), 1200);
            // è¶…æ—¶ååœæ­¢è§‚å¯Ÿ
            setTimeout(() => {
                if (!disconnected) {
                    observer.disconnect();
                    disconnected = true;
                }
                clearTimeout(t1);
                clearTimeout(t2);
            }, timeoutMs);
        }
        
        // æ˜¾ç¤ºå¼¹çª—
        function showSourceModal() {
            modal.style.display = 'flex';
            renderWordDocuments();
        }

        // æ¸²æŸ“Wordæ–‡æ¡£
        function renderWordDocuments() {
            // æ¸²æŸ“å®‰ä¸œçŸ³æ²¹æ–‡æ¡£
            fetch('https://static-host-vsu1427n-test.sealoshzh.site/document/anton.docx')
                .then(response => response.arrayBuffer())
                .then(buffer => {
                    const container = document.getElementById('anton-docx-container');
                    return docx.renderAsync(buffer, container, null, {
                        inWrapper: true,
                        ignoreWidth: false,
                        ignoreHeight: false
                    });
                })
                .then(() => {
                    // æ¸²æŸ“å®Œæˆåå°å»¶è¿Ÿï¼Œç¡®ä¿å¸ƒå±€ç¨³å®šå†æ»šåŠ¨å¹¶æŒç»­æ ¡æ­£
                    setTimeout(() => {
                        ensureScrollToPage('anton-docx-container', 2);
                    }, 120);
                })
                .catch(error => {
                    console.error('åŠ è½½å®‰ä¸œçŸ³æ²¹æ–‡æ¡£å¤±è´¥:', error);
                    document.getElementById('anton-docx-container').innerHTML = '<p>æ–‡æ¡£åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶è·¯å¾„æˆ–ç½‘ç»œè¿æ¥ã€‚</p>';
                });

            // æ¸²æŸ“æ–¯ä¼¦è´è°¢æ–‡æ¡£
            fetch('https://static-host-vsu1427n-test.sealoshzh.site/document/æ–¯ä¼¦è´è°¢.docx')
                .then(response => response.arrayBuffer())
                .then(buffer => {
                    const container = document.getElementById('schlumberger-docx-container');
                    return docx.renderAsync(buffer, container, null, {
                        inWrapper: true,
                        ignoreWidth: false,
                        ignoreHeight: false
                    });
                })
                .then(() => {
                    // æ¸²æŸ“å®Œæˆåå°å»¶è¿Ÿï¼Œç¡®ä¿å¸ƒå±€ç¨³å®šå†æ»šåŠ¨å¹¶æŒç»­æ ¡æ­£
                    setTimeout(() => {
                        ensureScrollToPage('schlumberger-docx-container', 5);
                    }, 120);
                })
                .catch(error => {
                    console.error('åŠ è½½æ–¯ä¼¦è´è°¢æ–‡æ¡£å¤±è´¥:', error);
                    document.getElementById('schlumberger-docx-container').innerHTML = '<p>æ–‡æ¡£åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶è·¯å¾„æˆ–ç½‘ç»œè¿æ¥ã€‚</p>';
                });
        }
        
        // å‘é€æ¶ˆæ¯
        function sendMessage() {
            const userText = chatInput.value.trim();
            if (!userText) return;

            appendMessage('user', userText);
            chatInput.value = '';

            setTimeout(() => {
                let response;
                if (userText.includes('æ€»ç»“å®‰ä¸œå’Œæ–¯ä¼¦è´è°¢QHSEåŸåˆ™çš„å·®å¼‚')) {
                    response = {
                        summary: `ä»¥ä¸‹æ˜¯<strong>å®‰ä¸œçŸ³æ²¹</strong>ä¸<strong>æ–¯ä¼¦è´è°¢ï¼ˆSchlumbergerï¼‰</strong>åœ¨QHSEï¼ˆè´¨é‡ã€å¥åº·ã€å®‰å…¨ã€ç¯å¢ƒï¼‰ç®¡ç†åŸåˆ™æ–¹é¢çš„<strong>å·®å¼‚æ€»ç»“</strong>ï¼ŒåŸºäºåŒæ–¹å…¬å¼€æ”¿ç­–æ–‡ä»¶å†…å®¹æ•´ç†ï¼š<br>
<h3>â— <strong>ä¸åŒç‚¹ï¼ˆå·®å¼‚åˆ†æï¼‰</strong></h3>
<table border="1" cellpadding="5" cellspacing="0">
<thead>
<tr>
<th>ç»´åº¦</th>
<th>å®‰ä¸œçŸ³æ²¹</th>
<th>æ–¯ä¼¦è´è°¢ï¼ˆSchlumbergerï¼‰</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>æ ¸å¿ƒä»·å€¼è§‚</strong></td>
<td>â€œ<strong>å…ˆæœ‰QHSEï¼Œåæœ‰å®‰ä¸œ</strong>â€â€”â€”å°†QHSEä½œä¸ºä¼ä¸šå­˜åœ¨çš„å‰ææ¡ä»¶ã€‚</td>
<td>â€œ<strong>Lead by example</strong>â€â€”â€”é¢†å¯¼ä»¥èº«ä½œåˆ™ï¼Œæ–‡åŒ–é©±åŠ¨è¡Œä¸ºã€‚</td>
</tr>
<tr>
<td><strong>æ„¿æ™¯ç›®æ ‡</strong></td>
<td>â€œé›¶ä¼¤äº¡ã€é›¶æ±¡æŸ“ã€é›¶æŸå¤±ã€é›¶æŠ•è¯‰â€</td>
<td>æœªæ˜ç¡®æå‡ºâ€œå››é›¶â€ï¼Œä½†å¼ºè°ƒâ€œ<strong>æŒç»­æ”¹è¿›</strong>â€å’Œâ€œ<strong>å“è¶Šç»©æ•ˆ</strong>â€ã€‚</td>
</tr>
<tr>
<td><strong>ç»„ç»‡æœºåˆ¶</strong></td>
<td>å»ºç«‹<strong>å®‰å§”ä¼š</strong>ç»Ÿä¸€é¢†å¯¼ï¼Œåˆ†çº§ç­¾è®¢è´£ä»»ä¹¦ï¼Œ<strong>å±åœ°ç®¡ç†+è´£ä»»åˆ¶</strong>æ˜ç¡®ã€‚</td>
</tr>
<tr>
<td><strong>æ–¯ä¼¦è´è°¢ï¼ˆSchlumbergerï¼‰</strong></td>
<td>å¼ºè°ƒ<strong>Line Managementï¼ˆç›´çº¿ç»ç†ï¼‰è´Ÿè´£åˆ¶</strong>ï¼ŒHSEèŒèƒ½ä¸ºæ”¯æŒä¸ç›‘ç£ã€‚</td>
</tr>
</tbody>
</table>
<br>
---<br><br>
<h3>âœ… æ€»ç»“ä¸€å¥è¯</h3>
<p>å®‰ä¸œçŸ³æ²¹ä»¥â€œåˆ¶åº¦+æ–‡åŒ–+é—®è´£â€ä¸‰ä½ä¸€ä½“ï¼Œå¼ºè°ƒ<strong>è´£ä»»åˆ°äººã€å±åœ°ä¸¥ç®¡</strong>ï¼›</p>
<p>æ–¯ä¼¦è´è°¢åˆ™ä»¥â€œé¢†å¯¼ç¤ºèŒƒ+ä½“ç³»æ ‡å‡†+æ•°æ®é©±åŠ¨â€ä¸ºæ ¸å¿ƒï¼Œå¼ºè°ƒ<strong>æ–‡åŒ–å¼•é¢†ã€æŒç»­æ”¹è¿›</strong>ã€‚</p>`,
                        hasSource: true
                    };
                } else {
                    response = {
                        summary: "æŠ±æ­‰ï¼Œæ­¤æ¼”ç¤ºä»…æ”¯æŒæŸ¥çœ‹â€œæ€»ç»“å®‰ä¸œå’Œæ–¯ä¼¦è´è°¢QHSEåŸåˆ™çš„å·®å¼‚â€é—®é¢˜ã€‚",
                        hasSource: false
                    };
                }
                appendBotMessageWithSource(response);
            }, 800);
        }

        function appendMessage(sender, text) {
            const messageEl = document.createElement('div');
            messageEl.className = `message ${sender}-message`;
            const content = `<div class="message-content">${text}</div>`;
            messageEl.innerHTML = sender === 'bot'
                ? `<div class="avatar">æ™º</div><div class="message-container">${content}</div>`
                : `<div class="message-container">${content}</div>`;
            chatBody.appendChild(messageEl);
            scrollToBottom();
        }

        function appendBotMessageWithSource(responseObj) {
            const messageEl = document.createElement('div');
            messageEl.className = 'message bot-message';
            const sourceLink = responseObj.hasSource
                ? `<div style="margin-top: 8px; font-size: 13px; color: #5f6368;"><a href="javascript:void(0)" class="source-link" style="color: #4A89E8; text-decoration: none;">ğŸ” æŸ¥çœ‹å‚è€ƒæ¥æº</a></div>`
                : '';

            messageEl.innerHTML = `
                <div class="avatar">æ™º</div>
                <div class="message-container">
                    <div class="message-content">${responseObj.summary}</div>
                    ${sourceLink}
                </div>
            `;
            chatBody.appendChild(messageEl);

            if (responseObj.hasSource) {
                messageEl.querySelector('.source-link').addEventListener('click', showSourceModal);
            }
            scrollToBottom();
        }

        function scrollToBottom() {
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        sendButton.addEventListener('click', sendMessage);
        chatInput.addEventListener('keydown', e => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // åˆå§‹åŒ–
        scrollToBottom();

        // æ·»åŠ æ¨èé—®é¢˜ç‚¹å‡»äº‹ä»¶
        function selectQuestion(question) {
            chatInput.value = question;
            sendMessage();
        }
    </script>
</body>
</html>